<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Format tables in Excel with macros | PEK’s developer blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Format tables in Excel with macros" />
<meta name="author" content="PEK" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you copy a table from a browser, or some other application, and then paste it into Excel it most certainly looks bad. You may have cells with content that spans over several rows, and texts that are badly formatted. Luckily, with a simple macro in Excel, that works in all your documents, this is easily solved." />
<meta property="og:description" content="If you copy a table from a browser, or some other application, and then paste it into Excel it most certainly looks bad. You may have cells with content that spans over several rows, and texts that are badly formatted. Luckily, with a simple macro in Excel, that works in all your documents, this is easily solved." />
<link rel="canonical" href="https://pekspro.github.io/posts/format-tables-in-excel-with-macros" />
<meta property="og:url" content="https://pekspro.github.io/posts/format-tables-in-excel-with-macros" />
<meta property="og:site_name" content="PEK’s developer blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-20T01:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Format tables in Excel with macros" />
<script type="application/ld+json">
{"description":"If you copy a table from a browser, or some other application, and then paste it into Excel it most certainly looks bad. You may have cells with content that spans over several rows, and texts that are badly formatted. Luckily, with a simple macro in Excel, that works in all your documents, this is easily solved.","headline":"Format tables in Excel with macros","dateModified":"2020-09-20T01:00:00+02:00","datePublished":"2020-09-20T01:00:00+02:00","url":"https://pekspro.github.io/posts/format-tables-in-excel-with-macros","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pekspro.github.io/posts/format-tables-in-excel-with-macros"},"author":{"@type":"Person","name":"PEK"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://pekspro.github.io/feed.xml" title="PEK's developer blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">PEK&#39;s developer blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/categories">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Format tables in Excel with macros</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-09-20T01:00:00+02:00" itemprop="datePublished">
        Sep 20, 2020
      </time>
        •  Categories: 
        <a href="/categories#excel">Excel</a>
      </p>
  </header>
  <div class="post-content e-content" itemprop="articleBody">
    <p>If you copy a table from a browser, or some other application, and then paste it
into Excel it most certainly looks bad. You may have cells with content that
spans over several rows, and texts that are badly formatted. Luckily, with a
simple macro in Excel, that works in all your documents, this is easily solved.</p>

<h2 id="the-problem">The problem</h2>

<p>Copy this table and paste it into Excel:</p>

<table>
  <thead>
    <tr>
      <th><strong>PlayerID</strong></th>
      <th><strong>First name</strong></th>
      <th><strong>Last name</strong></th>
      <th><strong>Birth date</strong></th>
      <th><strong>Notes</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Alice</td>
      <td>Aliceson</td>
      <td>1971-01-01</td>
      <td>Like rocks</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Bob</td>
      <td>Bobsson</td>
      <td>1972-02-02</td>
      <td>Never plays scissors</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Carol</td>
      <td>Carlsson</td>
      <td>1973-03-03</td>
      <td> </td>
    </tr>
    <tr>
      <td>4</td>
      <td>David</td>
      <td>Davidsson</td>
      <td>1974-04-04</td>
      <td>Very experienced</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Eric</td>
      <td>Ericsson</td>
      <td>1975-05-05</td>
      <td>Beginner</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Frank</td>
      <td>Franksson</td>
      <td>1976-06-06</td>
      <td> </td>
    </tr>
    <tr>
      <td>7</td>
      <td>Georg</td>
      <td>Georgsson</td>
      <td>1977-07-07</td>
      <td> </td>
    </tr>
    <tr>
      <td>8</td>
      <td>Henrik</td>
      <td>Henriksson</td>
      <td>1978-08-08</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>It will look something like this:</p>

<p><img src="/assets/images/0025/table_bad_format.png" alt="Badly formatted table" title="Badly formatted table" /></p>

<p>Not pretty. You may get a better result if you select <strong>Paste &gt; Paste Special</strong>
and then paste it as pure text. But still, there will be problems.</p>

<p>What I want is a shortcut to remove all formatting, make sure that the cells are
sized to the content and a table is created so it is easy to apply filters. Also,
since I often copy data from SQL Server Manager Studio, I want to remove the
string <code class="language-plaintext highlighter-rouge">NULL</code> automatically from all cells.</p>

<h2 id="the-solution">The solution</h2>

<p>Macros are useful feature in Excel. You could include macros in your documents,
but you rarely will have any need for that.</p>

<p>But macros could also be used in a personal macro file. This file is open
automatically you have Excel open and is normally not visible. In this file you
could have macros for things you do regularly.</p>

<p>If you follow this tutorial you will get two macros. One macro that makes your
tables look pretty. And another macro that formats cells as dates. This is
unfortunately lost when you run the first macro.</p>

<h3 id="create-a-personal-macro-workbook">Create a personal macro workbook</h3>

<p>Open Excel, and then go into the <strong>View</strong> tab and look for the <strong>Unhide</strong> button.</p>

<p><img src="/assets/images/0025/button_unhide_disabled.png" alt="Disabled unhide button" title="Disabled unhide button" /></p>

<p>Could you click on that? Great, do so and then got further to next step <strong>Add
some macros manually</strong>.</p>

<p>If the button is disabled, that means you have no personal file. The easiest way
to create on is to click on <strong>View &gt; Macros &gt; Record Macro</strong>.</p>

<p><img src="/assets/images/0025/menu_record_new_macro.png" alt="Record new macro" title="Record new macro" /></p>

<p>In <strong>Store macro in</strong> select <code class="language-plaintext highlighter-rouge">Personal Macro Workbook</code>. Then click <strong>OK</strong>.</p>

<p><img src="/assets/images/0025/window_record_macro.png" alt="Record macro settings" title="Record macro settings" /></p>

<p>Now Excel is recording what you are doing and will generate code from everything
you do. This is a great feature and I recommend you try it if you have not done
it before. But for now, we just want to create a macro file. Therefore, select
<strong>Macros &gt; Stop recording</strong>.</p>

<p><img src="/assets/images/0025/menu_stop_recording.png" alt="Stop recording" title="Stop recording" /></p>

<p>Now you should be able to click on <strong>View &gt; Unhide</strong>. Do so and select to unhide
<strong>personal.xlsb</strong>.</p>

<p><img src="/assets/images/0025/button_unhide_enabled.png" alt="Unhide" title="Unhide" /></p>

<h3 id="add-some-macros-manually">Add some macros manually</h3>

<p>Now when you could see the <strong>personal.xlsb</strong> file, select <strong>View &gt; Macros &gt; View
Macros</strong>. If the file was just created, it will look like this:</p>

<p><img src="/assets/images/0025/macro_list_original.png" alt="Macro list" title="Macro list" /></p>

<p>Now we will add some code. Select a macro and click on the <strong>Edit</strong> button.</p>

<p>Now the editor will pop up. This editor reminds me about Visual Basic 3.0 which
I used to create my very first Windows applications and very long, long time
ago. Good old days!</p>

<p>If all you see is an empty sub routine called <strong>Macro1</strong>, feel free to remove
that. Then add this code in the editor:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> Macro code </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            📄<span style="position: absolute; top: .25em; left: .25em">📄</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-visualbasic" data-lang="visualbasic"><span class="k">Sub</span> <span class="nf">MakePrettyTable</span><span class="p">()</span>
    <span class="c1">' Replace all cells there the content is exactly "NULL" with empty string.</span>
    <span class="c1">' This for fixing content copied from SQL Server Manager Studio.</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Replace</span> <span class="n">What</span><span class="p">:</span><span class="o">=</span><span class="s">"NULL"</span><span class="p">,</span> <span class="n">Replacement</span><span class="p">:</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">LookAt</span><span class="p">:</span><span class="o">=</span><span class="n">xlWhole</span><span class="p">,</span> <span class="n">_</span>
        <span class="n">SearchOrder</span><span class="p">:</span><span class="o">=</span><span class="n">xlByRows</span><span class="p">,</span> <span class="n">MatchCase</span><span class="p">:</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">SearchFormat</span><span class="p">:</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">_</span>
        <span class="n">ReplaceFormat</span><span class="p">:</span><span class="o">=</span><span class="k">False</span>

    <span class="c1">' Remove all hyperlinks</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Hyperlinks</span><span class="p">.</span><span class="n">Delete</span>
    
    <span class="c1">' Remove all formatting</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">ClearFormats</span>
    
    <span class="c1">' Make columns as wide as possible...</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">ColumnWidth</span> <span class="o">=</span> <span class="mi">250</span>
    <span class="c1">' auto fit the rows...</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="n">AutoFit</span>
    <span class="c1">' auto fit the columns.</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="n">AutoFit</span>
            
    <span class="c1">' Insert a table</span>
    <span class="n">ActiveSheet</span><span class="p">.</span><span class="n">ListObjects</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">xlSrcRange</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="p">,</span> <span class="n">xlYes</span><span class="p">).</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"Table"</span>
<span class="k">End</span> <span class="k">Sub</span>

<span class="k">Sub</span> <span class="nf">SetShortDate</span><span class="p">()</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">NumberFormat</span> <span class="o">=</span> <span class="s">"m/d/yyyy"</span>
<span class="k">End</span> <span class="k">Sub</span></code></pre></figure>

<p>The editor should look like this:</p>

<p><img src="/assets/images/0025/macro_editor.png" alt="Macro editor" title="Macro editor" /></p>

<p>Close the editor and then you are back in Excel.</p>

<h3 id="assign-shortcuts">Assign shortcuts</h3>

<p>Now we will make it easy to execute these macros. Again, in the
<strong>personal.xlsb</strong> document, select <strong>Macros &gt; View Macros</strong>. It should now look
something like this:</p>

<p><img src="/assets/images/0025/macro_list_updated.png" alt="Macro list" title="Macro list" /></p>

<p>As you see, you could just select a macro and click on <strong>Run</strong> to execute it.
This is fine for macros that you rarely use, but the macros we just added will
be used a lot. Select a macro and then click on <strong>Options</strong>.</p>

<p>Select the Shortcut key and enter a shortcut you want to use. Ctrl is
mandatory, so press <code class="language-plaintext highlighter-rouge">Shift + P</code> if you want to have the shortcut 
<code class="language-plaintext highlighter-rouge">Ctrl + Shift + P</code>. I used that for formatting table, and <code class="language-plaintext highlighter-rouge">Ctrl + Shift + D</code> for
setup dates.</p>

<p><img src="/assets/images/0025/shortcut_options.png" alt="Shortcut options" title="Shortcut options" /></p>

<p>Click <strong>OK</strong> and you are back to the list. Assign another shortcut to the other
macro and then close the settings.</p>

<h3 id="hide-personal-macro-file">Hide personal macro file</h3>

<p>Now when the macro file is configured it is time to hide it. In the
<strong>personal.xlsb</strong> document, select <strong>View &gt; Hide</strong>.</p>

<p><img src="/assets/images/0025/button_hide.png" alt="Hide button" title="Hide button" /></p>

<p>If you forgot to do this, two files will be open every time you open an Excel
file. This might drive you crazy.</p>

<h3 id="try-it">Try it</h3>

<p>If you have followed this tutorial you should now be back in your original
document with the bad looking table.</p>

<p>Select it (just make a cell in that table and press <code class="language-plaintext highlighter-rouge">Ctrl + A</code>) and then press
the shortcut you assigned to your macro. I used <code class="language-plaintext highlighter-rouge">Ctrl + Shift + P</code>. Now it looks
like this:</p>

<p><img src="/assets/images/0025/table_formatted.png" alt="Formatted table" title="Formatted table" /></p>

<p>As I mentioned earlier, all the data formats have also been lost so the dates
now looks like numbers (the number of days since 1 January 1900). Therefore,
select the <strong>Birth date</strong> column and press your other shortcut. I used
<code class="language-plaintext highlighter-rouge">Ctrl + Shift + D</code>.</p>

<p><img src="/assets/images/0025/table_formatted_date_corrected.png" alt="Date corrected" title="Date corrected" /></p>

<p>Now it looks perfect!</p>

<h2 id="summary">Summary</h2>

<p>Almost every day I have some data that I either need to analyze or share with
someone and then I use these macros. It makes me focus on more important things.</p>

<p>I am a bit annoyed that the data type settings are lost. This is due the
<strong>Selection.ClearFormats</strong> command in the macro and I have not found a way
around but.</p>

<p>But if you paste the content as text then that step is not necessary. The
following macro paste the content as text and then formats the table. In some
scenarios, this is a better solution.</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> Macro code </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            📄<span style="position: absolute; top: .25em; left: .25em">📄</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-visualbasic" data-lang="visualbasic"><span class="k">Sub</span> <span class="nf">PasteAsTextAndFormatTable</span><span class="p">()</span>
    <span class="c1">' The format us "Unicode Text" if you run Excel in English.</span>
    <span class="c1">' It might have another name in other languages. In Swedish it</span>
    <span class="c1">' is "Unicode-text"</span>
    <span class="n">ActiveSheet</span><span class="p">.</span><span class="n">PasteSpecial</span> <span class="n">Format</span><span class="p">:</span><span class="o">=</span><span class="s">"Unicode-text"</span><span class="p">,</span> <span class="n">Link</span><span class="p">:</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">_</span>
        <span class="n">DisplayAsIcon</span><span class="p">:</span><span class="o">=</span><span class="k">False</span>

    <span class="c1">' Replace all cells there the content is exactly "NULL" with empty string.</span>
    <span class="c1">' This for fixing content copied from SQL Server Manager Studio.</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Replace</span> <span class="n">What</span><span class="p">:</span><span class="o">=</span><span class="s">"NULL"</span><span class="p">,</span> <span class="n">Replacement</span><span class="p">:</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">LookAt</span><span class="p">:</span><span class="o">=</span><span class="n">xlWhole</span><span class="p">,</span> <span class="n">_</span>
        <span class="n">SearchOrder</span><span class="p">:</span><span class="o">=</span><span class="n">xlByRows</span><span class="p">,</span> <span class="n">MatchCase</span><span class="p">:</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">SearchFormat</span><span class="p">:</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">_</span>
        <span class="n">ReplaceFormat</span><span class="p">:</span><span class="o">=</span><span class="k">False</span>

    <span class="c1">' Remove all hyperlinks</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Hyperlinks</span><span class="p">.</span><span class="n">Delete</span>
    
    <span class="c1">' Make columns as wide as possible...</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">ColumnWidth</span> <span class="o">=</span> <span class="mi">250</span>
    <span class="c1">' auto fit the rows...</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="n">AutoFit</span>
    <span class="c1">' auto fit the columns.</span>
    <span class="n">Selection</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="n">AutoFit</span>
            
    <span class="c1">' Insert a table</span>
    <span class="n">ActiveSheet</span><span class="p">.</span><span class="n">ListObjects</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">xlSrcRange</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="p">,</span> <span class="n">xlYes</span><span class="p">).</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"Table"</span>
<span class="k">End</span> <span class="k">Sub</span></code></pre></figure>


  </div>
  
    <div id="archives" class="related"><div class="archive-group">
    
      
      <div id="#excel"></div>
      <p></p>
  
      <h3 class="category-head">More about Excel</h3>
      
      <article class="archive-item">
        <h4><a href="/posts/be-careful-with-references-in-power-query">Be careful with references in Power Query</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/creating-unique-excel-sheet-names">Creating unique Excel sheet names</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/calling-an-api-multiple-times-with-power-query">Calling an API multiple times with Power Query</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/creating-accruals-with-power-query">Creating accruals with Power Query</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/how-to-use-JWT-token-from-query-string">How to use JWT token from query string</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/using-power-query-and-web-api-with-http-authentication">Power Query and Web API with HTTP authentication</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/power-query-and-json-arrays">Power Query and JSON arrays</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/creating-excel-files-in-azure-functions">Creating Excel-files in Azure Functions</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/creating-excel-files-in-logic-apps">Creating Excel-files in Logic Apps</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/power-query-grouping-and-filtering-data">Power Query - Grouping and filtering data</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/power-query-joining-data">Power Query - Joining data</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/power-query-working-with-columns">Power Query - Working with columns</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/power-query-get-started-in-excel">Power Query - Get started in Excel</a></h4>
      </article>
      
    </div>
    
  
  </div><a class="u-url" href="/posts/format-tables-in-excel-with-macros" hidden></a>
</article>

<script src="/assets/javascript/copybutton.js"></script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">PEK</li>
          <li><a class="u-email" href="mailto:"></a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Interesting problems with interesting solutions.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/pekspro" title="pekspro"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
