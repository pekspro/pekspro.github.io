<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Create a time lapse video | PEKâ€™s developer blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Create a time lapse video" />
<meta name="author" content="PEK" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Letâ€™s create a time lapse video! We take some images, add some title screen background audio and a time stamp on each frame and combine all that to a video file. All this in C# and some help from ffmpeg." />
<meta property="og:description" content="Letâ€™s create a time lapse video! We take some images, add some title screen background audio and a time stamp on each frame and combine all that to a video file. All this in C# and some help from ffmpeg." />
<link rel="canonical" href="https://pekspro.github.io/posts/create-a-time-lapse-video" />
<meta property="og:url" content="https://pekspro.github.io/posts/create-a-time-lapse-video" />
<meta property="og:site_name" content="PEKâ€™s developer blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-05T01:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Create a time lapse video" />
<script type="application/ld+json">
{"description":"Letâ€™s create a time lapse video! We take some images, add some title screen background audio and a time stamp on each frame and combine all that to a video file. All this in C# and some help from ffmpeg.","headline":"Create a time lapse video","dateModified":"2020-07-05T01:00:00+02:00","datePublished":"2020-07-05T01:00:00+02:00","url":"https://pekspro.github.io/posts/create-a-time-lapse-video","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pekspro.github.io/posts/create-a-time-lapse-video"},"author":{"@type":"Person","name":"PEK"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://pekspro.github.io/feed.xml" title="PEK's developer blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">PEK&#39;s developer blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/categories">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Create a time lapse video</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-07-05T01:00:00+02:00" itemprop="datePublished">
        Jul 5, 2020
      </time>
        â€¢  Categories: 
        <a href="/categories#net">.NET</a>
      </p>
  </header>
  <div class="post-content e-content" itemprop="articleBody">
    <p>Letâ€™s create a time lapse video! We take some images, add some title screen
background audio and a time stamp on each frame and combine all that to a video
file. All this in C# and some help from <a href="https://ffmpeg.org/">ffmpeg</a>.</p>

<p><a href="https://ffmpeg.org/">ffmpeg</a> is an open source tool that is very often used to
generated video and it is available on several platforms. It can do a lot of
things but is a bit tricky to use in my opinion. If you are using Windows, you
need to download the tool and have it on some well-known place. A good thing is
that you only need a single file - <code class="language-plaintext highlighter-rouge">ffmpeg.exe</code>. If you are using some other
platform you probably found some other way ;-)</p>

<p>The end result looks like this:</p>

<video controls="" poster="/assets/images/0014/thumbnail.png">
  <source src="/assets/images/0014/sample.mp4" type="video/mp4" />
</video>

<p>Maybe not to exiting :-) But replace this with some proper photos and it will be
more interesting, I promise!</p>

<h2 id="strategy">Strategy</h2>

<p>The complete code is aviliable on my GitHub project <a href="https://github.com/pekspro/TimeLapseCreator">Time lapse
creator</a>. It is just about 500
lines of code, and I hope it is easy to understand. Here I explain what the
application does.</p>

<h3 id="step-1---get-the-images">Step 1 - Get the images</h3>

<p>In the first step the path to all the original images will be found. This is
done in the method <code class="language-plaintext highlighter-rouge">GetOriginalImagesAsync</code>. In this demo code the images will
be autogenerated instead. They look something like this:</p>

<p><img src="/assets/images/0014/original-001.png" alt="Original image 1" title="Original image 1" /></p>

<p><img src="/assets/images/0014/original-002.png" alt="Original image 2" title="Original image 2" /></p>

<p><img src="/assets/images/0014/original-003.png" alt="Original image 3" title="Original image 3" /></p>

<h3 id="step-2---create-title-screen-frames">Step 2 - Create title screen frames</h3>

<p>Every professional movie has a title screen. This is generated in the method
<code class="language-plaintext highlighter-rouge">CreateTitleScreenAsync</code>, and the images looks like this:</p>

<p><img src="/assets/images/0014/title-001.png" alt="Title image 1" title="Title image 1" /></p>

<p><img src="/assets/images/0014/title-002.png" alt="Title image 2" title="Title image 2" /></p>

<p><img src="/assets/images/0014/title-003.png" alt="Title image 3" title="Title image 3" /></p>

<p>As you see the text will be faded in. I solved this but creating each frame
individually. Another way to solve use to use the fading options when the movie
is rendered.</p>

<h3 id="step-3---create-frames-from-images">Step 3 - Create frames from images</h3>

<p>Our original images are just pure images. But sense we are making a time lapse we
want to add a visible timestamp on every frame. Also, we want to fade
from the title screen. This is done in the method <code class="language-plaintext highlighter-rouge">CreateOverlayImagesAsync</code>,
and the images then look like this:</p>

<p><img src="/assets/images/0014/frame-001.png" alt="Frame 1" title="Frame 1" /></p>

<p><img src="/assets/images/0014/frame-002.png" alt="Frame 2" title="Frame 2" /></p>

<p><img src="/assets/images/0014/frame-003.png" alt="Frame 3" title="Frame 3" /></p>

<p><img src="/assets/images/0014/frame-004.png" alt="Frame 4" title="Frame 4" /></p>

<h3 id="step-4---create-a-thumbnail-image">Step 4 - Create a thumbnail image</h3>

<p>It is nice a have a thumbnail image added to our movie. This is then used for
instance in Explorer to give you a hint what the movie is about. This image is
created in <code class="language-plaintext highlighter-rouge">CreateThumbnailImageAsync</code> and look like this.</p>

<p><img src="/assets/images/0014/thumbnail.png" alt="Thumbnail image" title="Thumbnail image" /></p>

<p>Note the thumbnail image in the final video is not used in a <code class="language-plaintext highlighter-rouge">video</code> element in
a HTML element. Instead you should define the thumbnail image in the <code class="language-plaintext highlighter-rouge">poster</code>
attribute like this:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> HTML </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;video</span> <span class="na">controls</span> <span class="na">poster=</span><span class="s">"thumbnail.png"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"movie.mp4"</span> <span class="na">type=</span><span class="s">"video/mp4"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/video&gt;</span></code></pre></figure>

<h3 id="step-5---render-the-movie">Step 5 - Render the movie</h3>

<p>Now when we have everything in place, we will let <code class="language-plaintext highlighter-rouge">ffmpeg</code> do the work
for us. This is a bit complicated, but the method <code class="language-plaintext highlighter-rouge">RenderVideoAsync</code> takes
care of all of the hard stuff. Note that you need to know were <code class="language-plaintext highlighter-rouge">ffmpeg</code>
is located.</p>

<h2 id="summary">Summary</h2>

<p>This was very fun to do but it took me forever to get everything right. There
are NuGet packages available that makes it a bit easier to use <code class="language-plaintext highlighter-rouge">ffmpeg</code> and I
tried a couple of those in the beginning. But I ended up doing it myself, after
all it is just a command line application, so it is quite straightforward if you
just get the arguments right.</p>

<p>One thing I found out the hard way is that you cannot mix different image
formats when you are rendering the video. For instance, you cannot have both
JPEG and PNG files in your file list.</p>

<p>Rendering video locally could be fun, but I have also used similar code in Azure
Functions to autogenerate movies. You could read more about this in my
<a href="/posts/lessons-learned-from-rendering-video-in-azure-functions">follow-up post</a>.</p>

  </div>
  
    <div id="archives" class="related"><div class="archive-group">
    
      
      <div id="#net"></div>
      <p></p>
  
      <h3 class="category-head">More about .NET</h3>
      
      <article class="archive-item">
        <h4><a href="/posts/get-time-zone-for-a-user-in-graph">Get time zone for a user in Graph</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/invite-to-a-meeting">Invite to a meeting</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/caching-configuration-from-azure-keyvault">Caching configuration from Azure KeyVault</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/creating-unique-excel-sheet-names">Creating unique Excel sheet names</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/finding-objects-that-are-not-disposed">Finding objects that are not disposed</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/finding-redundant-project-references">Finding redundant project references</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/policyscope">PolicyScope</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/manually-creating-a-dbcontext-and-enable-logging">Manually creating a DbContext and enable logging</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/graphemes">Graphemes</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/withpartitionkey-and-in-memory-database">WithPartitionKey and in-memory database</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/net5-and-azure-functions">.NET 5 and Azure Functions</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/how-to-use-JWT-token-from-query-string">How to use JWT token from query string</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/what-characters-are-whitespace">What characters are whitespace?</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/trimming-whitespace-in-objects">Trimming whitespace in objects</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/modifying-query-string">Modifying query strings</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/change-language-version-on-multiple-projects">Change language version on multiple projects</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/change-encoding-on-your-source-files">Change encoding on your source files</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/build-time">Build time</a></h4>
      </article>
      
    </div>
    
  
  </div><a class="u-url" href="/posts/create-a-time-lapse-video" hidden></a>
</article>

<script src="/assets/javascript/copybutton.js"></script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">PEK</li>
          <li><a class="u-email" href="mailto:"></a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Interesting problems with interesting solutions.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/pekspro" title="pekspro"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
