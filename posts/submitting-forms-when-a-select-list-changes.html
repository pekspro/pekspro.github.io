<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Submitting forms when a select list changes | PEKâ€™s developer blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Submitting forms when a select list changes" />
<meta name="author" content="PEK" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="On a page I created recently, there as a simple select list. When the select value was changed it was supposed to submit a form." />
<meta property="og:description" content="On a page I created recently, there as a simple select list. When the select value was changed it was supposed to submit a form." />
<link rel="canonical" href="https://pekspro.github.io/posts/submitting-forms-when-a-select-list-changes" />
<meta property="og:url" content="https://pekspro.github.io/posts/submitting-forms-when-a-select-list-changes" />
<meta property="og:site_name" content="PEKâ€™s developer blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-13T01:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Submitting forms when a select list changes" />
<script type="application/ld+json">
{"description":"On a page I created recently, there as a simple select list. When the select value was changed it was supposed to submit a form.","headline":"Submitting forms when a select list changes","dateModified":"2020-09-13T01:00:00+02:00","datePublished":"2020-09-13T01:00:00+02:00","url":"https://pekspro.github.io/posts/submitting-forms-when-a-select-list-changes","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pekspro.github.io/posts/submitting-forms-when-a-select-list-changes"},"author":{"@type":"Person","name":"PEK"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://pekspro.github.io/feed.xml" title="PEK's developer blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">PEK&#39;s developer blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/categories">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Submitting forms when a select list changes</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-09-13T01:00:00+02:00" itemprop="datePublished">
        Sep 13, 2020
      </time>
        â€¢  Categories: 
        <a href="/categories#javascript">JavaScript</a>
      </p>
  </header>
  <div class="post-content e-content" itemprop="articleBody">
    <p>On a page I created recently, there as a simple select list. When the select
value was changed it was supposed to submit a form.</p>

<h2 id="the-problem">The problem</h2>

<p>Look on this code:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> HTML </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;select</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">" "</span><span class="nt">&gt;</span>(Select value)<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"red"</span><span class="nt">&gt;</span>Red<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"green"</span><span class="nt">&gt;</span>Green<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"blue"</span><span class="nt">&gt;</span>Blue<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p>When the selected item is changed, the form should be submitted. The classic way
to solve this is just to add some basic JavaScript code:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> HTML </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;select</span> <span class="na">onchange=</span><span class="s">"this.form.submit()"</span><span class="nt">&gt;</span></code></pre></figure>

<p>It totally works. But if you are using <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security
Policy</a> it gets more
complicated. In some situations, it might be tricky to get this to work with
Blazor. And if you like me and want to see as little JavaScript as possible you
may want something else.</p>

<h2 id="the-solution">The solution</h2>

<p>My solution was to run JavaScript code when every page is loaded, and let it
monitor changes to the DOM. When it detects elements that has the class
attribute <code class="language-plaintext highlighter-rouge">submit-on-change</code>, it will add an event listener that then is
submitting the form. It will also remove the event listeners if the attribute is
removed.</p>

<p>So, my sample code just needs to change to this:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> HTML </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"get"</span> <span class="na">class=</span><span class="s">"submit-on-change"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;select</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">" "</span><span class="nt">&gt;</span>(Select value)<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"red"</span><span class="nt">&gt;</span>Red<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"green"</span><span class="nt">&gt;</span>Green<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"blue"</span><span class="nt">&gt;</span>Blue<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure>

<p>Very simple! And as a bonus nothing is submitted if the first element is
selected where the value is just a space. It cannot be empty, because then the
value will be the text instead. HTML and JavaScript is weird sometimesâ€¦</p>

<p>Anyway, the code that do this magic is this TypeScript code:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> TypeScript </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-typescript" data-lang="typescript"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">//This will be called when a select list has changed value</span>
    <span class="kd">const</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="k">as</span> <span class="nx">HTMLSelectElement</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//This will add key event listener on all nodes with the class preventEnter.</span>
    <span class="kd">function</span> <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">node</span><span class="p">:</span> <span class="nx">Node</span><span class="p">,</span> <span class="nx">add</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">node</span> <span class="k">as</span> <span class="nx">HTMLSelectElement</span><span class="p">;</span>

            <span class="c1">//Check if main element contains class</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit-on-change</span><span class="dl">"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Adding event listener: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Removing event listener: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//This will add key event listener on all nodes with the class preventEnter.</span>
    <span class="kd">function</span> <span class="nx">setupEventsOnElements</span><span class="p">(</span><span class="nx">nodelist</span><span class="p">:</span> <span class="nx">NodeList</span> <span class="o">|</span> <span class="nx">HTMLCollectionOf</span><span class="o">&lt;</span><span class="nx">Element</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">add</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nodelist</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">nodelist</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>

                <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">node</span> <span class="k">as</span> <span class="nx">HTMLSelectElement</span><span class="p">;</span>

                <span class="c1">//Check if main element contains class</span>
                <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">add</span><span class="p">);</span>

                <span class="c1">//Check if any child nodes contains class</span>
                <span class="kd">const</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit-on-change</span><span class="dl">"</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">add</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Create an observer instance linked to the callback function</span>
    <span class="c1">// Read more: https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver</span>
    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span>
        <span class="kd">function</span> <span class="p">(</span><span class="nx">mutations</span><span class="p">:</span> <span class="nx">MutationRecord</span><span class="p">[])</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">mutation</span> <span class="k">of</span> <span class="nx">mutations</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">childList</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>

                    <span class="c1">// A child node has been added or removed.</span>
                    <span class="nx">setupEventsOnElements</span><span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">addedNodes</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">attributes</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">attributeName</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">class</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">mutation</span><span class="p">.</span><span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// console.log('The ' + mutation.attributeName + ' attribute was modified on' + (mutation.target as HTMLElement).id);</span>

                        <span class="c1">//class was modified on this node. Remove previous event handler (if any).</span>
                        <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
                        <span class="c1">//And add event handler if class i specified.</span>
                        <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">);</span>

    <span class="c1">// Configure observer</span>
    <span class="kd">const</span> <span class="nx">observerConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">attributes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">attributeFilter</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">]</span> <span class="p">};</span>

    <span class="c1">// Start observing the target node for configured mutations</span>
    <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">observerConfig</span><span class="p">);</span>

    <span class="c1">//Also check all elements when loaded.</span>
    <span class="nx">setupEventsOnElements</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit-on-change</span><span class="dl">"</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>Or, if you prefer pure JavaScript instead:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> JavaScript </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//This will be called when a select list has changed value</span>
    <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="c1">//This will add key event listener on all nodes with the class preventEnter.</span>
    <span class="kd">function</span> <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
            <span class="c1">//Check if main element contains class</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit-on-change</span><span class="dl">"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Adding event listener: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Removing event listener: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//This will add key event listener on all nodes with the class preventEnter.</span>
    <span class="kd">function</span> <span class="nx">setupEventsOnElements</span><span class="p">(</span><span class="nx">nodelist</span><span class="p">,</span> <span class="nx">add</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nodelist</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">nodelist</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">node</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
                <span class="c1">//Check if main element contains class</span>
                <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">add</span><span class="p">);</span>
                <span class="c1">//Check if any child nodes contains class</span>
                <span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit-on-change</span><span class="dl">"</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i_2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i_2</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i_2</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">elements</span><span class="p">[</span><span class="nx">i_2</span><span class="p">],</span> <span class="nx">add</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Create an observer instance linked to the callback function</span>
    <span class="c1">// Read more: https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver</span>
    <span class="kd">var</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">mutations</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">mutations_2</span> <span class="o">=</span> <span class="nx">mutations</span><span class="p">;</span> <span class="nx">_i</span> <span class="o">&lt;</span> <span class="nx">mutations_2</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">_i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">mutation</span> <span class="o">=</span> <span class="nx">mutations_2</span><span class="p">[</span><span class="nx">_i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">childList</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// A child node has been added or removed.</span>
                <span class="nx">setupEventsOnElements</span><span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">addedNodes</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">attributes</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">attributeName</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">class</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">mutation</span><span class="p">.</span><span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">HTMLSelectElement</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// console.log('The ' + mutation.attributeName + ' attribute was modified on' + (mutation.target as HTMLElement).id);</span>
                    <span class="c1">//class was modified on this node. Remove previous event handler (if any).</span>
                    <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
                    <span class="c1">//And add event handler if class i specified.</span>
                    <span class="nx">setupEvent</span><span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">// Configure observer</span>
    <span class="kd">var</span> <span class="nx">observerConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">attributes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">attributeFilter</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">]</span> <span class="p">};</span>
    <span class="c1">// Start observing the target node for configured mutations</span>
    <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">observerConfig</span><span class="p">);</span>
    <span class="c1">//Also check all elements when loaded.</span>
    <span class="nx">setupEventsOnElements</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit-on-change</span><span class="dl">"</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>I think this should work in all modern browsers.</p>

<h2 id="summary">Summary</h2>

<p>This solution is like the one I developed in my earlier post
<a href="/posts/prevent-enter-to-submit-forms">Prevent enter to submit forms</a>. 
I am sure I will make more like this in the future :-)</p>

  </div>
  
    <div id="archives" class="related"><div class="archive-group">
    
      
      <div id="#javascript"></div>
      <p></p>
  
      <h3 class="category-head">More about JavaScript</h3>
      
      <article class="archive-item">
        <h4><a href="/posts/what-characters-are-whitespace">What characters are whitespace?</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/trimming-whitespace-in-input-controls">Trimming whitespace in input controls</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/autoscroll">Autoscroll</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/prevent-enter-to-submit-forms">Prevent enter to submit forms</a></h4>
      </article>
      
    </div>
    
  
  </div><a class="u-url" href="/posts/submitting-forms-when-a-select-list-changes" hidden></a>
</article>

<script src="/assets/javascript/copybutton.js"></script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">PEK</li>
          <li><a class="u-email" href="mailto:"></a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Interesting problems with interesting solutions.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/pekspro" title="pekspro"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
