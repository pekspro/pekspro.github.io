<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>.NET 5 and Azure Functions | PEKâ€™s developer blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content=".NET 5 and Azure Functions" />
<meta name="author" content="PEK" />
<meta property="og:locale" content="en_US" />
<meta name="description" content=".NET 5 have been out for a few weeks when writing then. Upgrading from .NET Core 3.1 has been easy, I think. Except when it comes to Azure Functions." />
<meta property="og:description" content=".NET 5 have been out for a few weeks when writing then. Upgrading from .NET Core 3.1 has been easy, I think. Except when it comes to Azure Functions." />
<link rel="canonical" href="https://pekspro.github.io/posts/net5-and-azure-functions" />
<meta property="og:url" content="https://pekspro.github.io/posts/net5-and-azure-functions" />
<meta property="og:site_name" content="PEKâ€™s developer blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-13T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content=".NET 5 and Azure Functions" />
<script type="application/ld+json">
{"description":".NET 5 have been out for a few weeks when writing then. Upgrading from .NET Core 3.1 has been easy, I think. Except when it comes to Azure Functions.","headline":".NET 5 and Azure Functions","dateModified":"2020-12-13T00:00:00+01:00","datePublished":"2020-12-13T00:00:00+01:00","url":"https://pekspro.github.io/posts/net5-and-azure-functions","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pekspro.github.io/posts/net5-and-azure-functions"},"author":{"@type":"Person","name":"PEK"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://pekspro.github.io/feed.xml" title="PEK's developer blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">PEK&#39;s developer blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/categories">Categories</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">.NET 5 and Azure Functions</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-12-13T00:00:00+01:00" itemprop="datePublished">
        Dec 13, 2020
      </time>
        â€¢  Categories: 
        <a href="/categories#net">.NET</a>,
            <a href="/categories#powershell">PowerShell</a>
      </p>
  </header>
  <div class="post-content e-content" itemprop="articleBody">
    <p>.NET 5 have been out for a few weeks when writing then. Upgrading from .NET Core
3.1 has been easy, I think. Except when it comes to Azure Functions.</p>

<h2 id="the-problem">The problem</h2>

<p>To keep it short, at the moment of writing this Azure Functions does not support
.NET 5. As I understand it, the process that is executing you functions library
is built with .NET Core 3.1. And if you are using a library, like
<strong>Microsoft.Extensions.Logging.Abstractions</strong>, that is also used by the main
host â€“ but it is using a different version â€“ you get strange errors like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>System.Private.CoreLib: Could not load file or assembly 'Microsoft.Extensions.Logging.Abstractions,
Version=5.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60'.
</code></pre></div></div>

<p>The problem is discussed in <a href="https://github.com/Azure/azure-functions-host/issues/6674">Issue 6674</a>
in the projects GitHub repository.</p>

<h2 id="the-solution">The solution</h2>

<p>The suggestion workaround so far is to use .NET Standard libraries and use the
older version of NuGet-packages. But I find it a bit messy to use different
version NuGet-packages. Especially since the problem is detected first when you
execute your application, not in compile time. So, I decided to do something
else.</p>

<p>In my project file, for my Azure Functions project, I referenced to other
projects like this:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> Project File </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\DatabaseLibrary\DatabaseLibrary.csproj"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\LogicLibrary\LogicLibrary.csproj"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span></code></pre></figure>

<p>I removed this and decided to instead to link to every file in the other projects instead. The code above was then replaced with this:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> Project File </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"..\DatabaseLibrary\DatabaseHelper.cs"</span> <span class="na">Link=</span><span class="s">"Dependencies\DatabaseLibrary\DatabaseHelper.cs"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"..\DatabaseLibrary\DatabaseManager.cs"</span> <span class="na">Link=</span><span class="s">"Dependencies\DatabaseLibrary\DatabaseManager.cs"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"..\LogicLibrary\LogicHelper.cs"</span> <span class="na">Link=</span><span class="s">"Dependencies\LogicLibrary\LogicHelper.cs"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"..\LogicLibrary\LogicManager.cs"</span> <span class="na">Link=</span><span class="s">"Dependencies\LogicLibrary\LogicManager.cs"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span></code></pre></figure>

<p>This way, I have better control on which NuGet-packages to use (that I instead
references directly in my Azure Functions project).</p>

<p>In Visual Studio, you could right click on a project, select <strong>Add</strong> and then
<strong>Existing Item</strong>. Then you select the files you want to use and use the
drop-down menu and select <strong>Add As Link</strong>. But if you have a lot files this
could be a bit tedious. Instead, you could run this PowerShell-script in the
folder where you have your library:</p>

<div class="codeHeader" data-bi-name="code-header">
    <span class="language"> PowerShell </span>
    <button type="button" class="action is-relative copy-code-button" aria-label="Copy code">
        <span style="font-size: .800em; margin-right: .25em; position: relative; top: -.25em; left: -.200em; pointer-events: none;">
            ðŸ“„<span style="position: absolute; top: .25em; left: .25em">ðŸ“„</span>
        </span>
        <span style="pointer-events: none;">Copy</span>
        <div class="successful-copy-alert is-transparent" style="pointer-events: none;" aria-hidden="true">
            &#10003;
        </div>
    </button> 
</div>

<figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="n">Get-ChildItem</span><span class="w"> </span><span class="o">*.</span><span class="nf">cs</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="se">`
</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-notlike</span><span class="w"> </span><span class="s2">"*\Debug\*"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-notlike</span><span class="w"> </span><span class="s2">"*\Release\*"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">`</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"    &lt;Compile Include=""..\</span><span class="si">$(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="o">.</span><span class="nf">SubString</span><span class="p">(</span><span class="nx">62</span><span class="p">)</span><span class="si">)</span><span class="s2">"" Link=""Dependencies\</span><span class="si">$(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">FullName</span><span class="o">.</span><span class="nf">SubString</span><span class="p">(</span><span class="nx">62</span><span class="p">)</span><span class="si">)</span><span class="s2">"" /&gt;"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">`</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="n">Set-Clipboard</span></code></pre></figure>

<p>This code:</p>

<ul>
  <li>Get all .cs-files</li>
  <li>Ignores files in <code class="language-plaintext highlighter-rouge">Debug</code> and <code class="language-plaintext highlighter-rouge">Release</code> directories.</li>
  <li>Creates a string for each file that should be in the project file. You might
need to adjust the value of the SubString call.</li>
  <li>Copies everything to the clipboard.</li>
</ul>

<p>You should then be able to paste everything into your project file.</p>

<h2 id="summary">Summary</h2>

<p>Clearly, this solution has some limitations. For instance, you code must be able
to be compiled with .NET Core 3.1. Also, if you change the files that you have
in your libraries you may also need to change this in the Azure Functions
project.</p>

<p>But for me, I decided that this is good enough. Azure Functions will have a
preview with .NET 5 support quite soon, so I do not mind having it like this for
a while.</p>

  </div>
  
    <div id="archives" class="related"><div class="archive-group">
    
      
      <div id="#net"></div>
      <p></p>
  
      <h3 class="category-head">More about .NET</h3>
      
      <article class="archive-item">
        <h4><a href="/posts/get-time-zone-for-a-user-in-graph">Get time zone for a user in Graph</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/invite-to-a-meeting">Invite to a meeting</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/caching-configuration-from-azure-keyvault">Caching configuration from Azure KeyVault</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/creating-unique-excel-sheet-names">Creating unique Excel sheet names</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/finding-objects-that-are-not-disposed">Finding objects that are not disposed</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/finding-redundant-project-references">Finding redundant project references</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/policyscope">PolicyScope</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/manually-creating-a-dbcontext-and-enable-logging">Manually creating a DbContext and enable logging</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/graphemes">Graphemes</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/withpartitionkey-and-in-memory-database">WithPartitionKey and in-memory database</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/how-to-use-JWT-token-from-query-string">How to use JWT token from query string</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/what-characters-are-whitespace">What characters are whitespace?</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/trimming-whitespace-in-objects">Trimming whitespace in objects</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/modifying-query-string">Modifying query strings</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/create-a-time-lapse-video">Create a time lapse video</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/change-language-version-on-multiple-projects">Change language version on multiple projects</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/change-encoding-on-your-source-files">Change encoding on your source files</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/build-time">Build time</a></h4>
      </article>
      
    </div>
    
  
  
  
    <div class="archive-group">
    
      
      <div id="#powershell"></div>
      <p></p>
  
      <h3 class="category-head">More about PowerShell</h3>
      
      <article class="archive-item">
        <h4><a href="/posts/finding-redundant-project-references">Finding redundant project references</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/prettifying-json-with-powerwhell">Prettifying JSON with PowerShell</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/multiple-find-and-replace-with-powershell">Multiple find and replace with PowerShell</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/extracting-urls-from-files-with-powershell">Extracting URL:s from files with PowerShell</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/change-encoding-on-your-source-files">Change encoding on your source files</a></h4>
      </article>
      
      <article class="archive-item">
        <h4><a href="/posts/compiling-with-a-RAM-Drive">Compiling with a RAM-drive</a></h4>
      </article>
      
    </div>
    
  
  </div><a class="u-url" href="/posts/net5-and-azure-functions" hidden></a>
</article>

<script src="/assets/javascript/copybutton.js"></script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">PEK</li>
          <li><a class="u-email" href="mailto:"></a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Interesting problems with interesting solutions.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/pekspro" title="pekspro"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
